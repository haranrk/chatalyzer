<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <title>Chatalyzer Analysis</title>
        <link rel="stylesheet" href={{ url_for('static', filename='css/bootstrap.min.css') }} >
        <link rel="stylesheet" href={{ url_for('static', filename='css/main.css') }} >
    </head>
    <body>
        {% include 'navbar.html' %}
        <div class="position-relative overflow-hidden p-3 p-md-5 m-md-3 text-center bg-light">
          <div class="col-md-5 p-lg-5 mx-auto my-5">
            <h1 class="display-4 font-weight-normal">The Analysis</h1>
            <p class="lead font-weight-normal"> Total number of messages sent {{ num_msgs }} </p>
            <!--<a class="btn btn-outline-secondary" href="#">Coming soon</a>-->
          </div>
        </div>

  <div class="text-center">
    <h2 class="">Total Word Count</h2>
    <!--<p class="lead">And an even wittier subheading.</p>-->
    <div id="word_count" class="bg-light" style="width: 80%; height: 300px;"></div>
  </div>
<div class="d-md-flex flex-md-equal w-100 my-md-3 pl-md-3">
  <div class="bg-dark mr-md-3 pt-3 px-3 pt-md-5 px-md-5 text-center text-white overflow-hidden">
    <div class="my-3 py-3">
      <h2 class="display-5">Total Message Count</h2>
      <!--<p class="lead">And an even wittier subheading.</p>-->
    </div>
    <div id="top_message_senders" class="bg-dark text-white" style="width: 80%; height: 300px;"></div>

  </div>
  <div class="bg-light mr-md-3 pt-3 px-3 pt-md-5 px-md-5 text-center overflow-hidden">
  </div>
</div>

<div class="d-md-flex flex-md-equal w-100 my-md-3 pl-md-3">
  <div class="bg-light mr-md-3 pt-3 px-3 pt-md-5 px-md-5 text-center overflow-hidden">
    <div class="my-3 p-3">
      <h2 class="display-5">Letter Count</h2>
      <!--<p class="lead">And an even wittier subheading.</p>-->
    </div>
    <div id="letter_count" class="bg-light " style="width: 80%; height: 300px;"></div>
  </div>
  <div class="bg-dark mr-md-3 pt-3 px-3 pt-md-5 px-md-5 text-center text-white overflow-hidden">
    <div class="my-3 py-3">
      <h2 class="display-5">Daywise Messages</h2>
      <p class="lead">Try zooming and panning</p>
    </div>
    <div id="daywise_messages" class="bg-dark " style="width: 80%; height: 300px;"></div>
  </div>
</div>

<div class="d-md-flex flex-md-equal w-100 my-md-3 pl-md-3">
  <div class="bg-dark mr-md-3 pt-3 px-3 pt-md-5 px-md-5 text-center text-white overflow-hidden">
    <div class="my-3 p-3">
      <h2 class="display-5">Top Media Senders</h2>
      <!-- <p class="lead">And an even wittier subheading.</p> -->
    </div>
    <div id="top_media_senders" class="bg-dark " style="width: 80%; height: 300px;"></div>
  </div>
  <div class="bg-light mr-md-3 pt-3 px-3 pt-md-5 px-md-5 text-center overflow-hidden">
    <div class="my-3 py-3">
      <h2 class="display-5">Common Emojis</h2>
      <!-- <p class="lead">And an even wittier subheading.</p> -->
    </div>
    <div id="most_used_emojis" class="bg-light" style="width: 80%; height: 300px;"></div>
  </div>
</div>

<div class="d-md-flex flex-md-equal w-100 my-md-3 pl-md-3">
  <div class="bg-light mr-md-3 pt-3 px-3 pt-md-5 px-md-5 text-center overflow-hidden">
    <div class="my-3 p-3">
      <h2 class="display-5">Common Words</h2>
      <!--<p class="lead">And an even wittier subheading.</p>-->
    </div>
    <div id="most_used_words" class="bg-light" style="width: 80%; height: 300px;"></div>
  </div>
  <div class="bg-dark mr-md-3 pt-3 px-3 pt-md-5 px-md-5 text-center text-white overflow-hidden">
    <div class="my-3 py-3">
      <h2 class="display-5">Daywise messages by author</h2>
      <!-- <p class="lead">And an even wittier subheading.</p> -->
    <div id="authorwise_daywise_messages" class="bg-dark " style="width: 80%; height: 300px;"></div>
    </div>
  </div>
</div>
</body>

<script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>
<script src={{ url_for('static', filename='js/jquery-3.4.1.min.js') }} ></script>
<script src={{ url_for('static', filename='js/bootstrap.bundle.min.js') }} ></script>
<script src={{ url_for('static', filename='js/d3.min.js') }} ></script>
<script src={{ url_for('static', filename='js/d3.layout.cloud.js') }} ></script>
<!--<script src={{ url_for('static', filename='js/analysis.js') }} ></script>-->
<script>

var top_message_senders = {{ top_message_senders|safe }};
var word_count = {{ word_count|safe }};
var letter_count = {{ letter_count|safe }};
var top_media_senders = {{ top_media_senders|safe }};
var most_used_emojis = {{ most_used_emojis|safe }}
var daywise_message_count = {{ daywise_message_count|safe }};
var data = {{ authorwise_daywise_message_count |safe }}

word_count = word_count.map((dataPoint) => {
  return {
    x:dataPoint[0], 
    y:dataPoint[1]
  } 
})
var options = {
  chart: {
    type: 'bar'
  },
  series: [{
    data: word_count.slice(0,20)
  }],
}

var chart = new ApexCharts(document.querySelector("#word_count"), options);

chart.render();
</script>


<script>
function wordCloud(svgId, data){
  var margin = {"left": 40, "right": 60, "top":1, "bottom":20};
  var graphWidth = 600;
  var graphHeight = 300;
  var h = margin.top + graphHeight + margin.bottom;
  var w = margin.left + graphWidth+ margin.right;

  data_obj = Object.assign(...data.map(([k, v]) => ({ [k]: v })));

  var fill = d3.scaleOrdinal(d3.schemeTableau10)
  var word_entries = d3.entries(data_obj);

  var xScale = d3.scaleLinear()
      .domain([0, d3.max(word_entries, d => d.value)])
      .range([10, 100]);

  d3.layout.cloud().size([w, h])
      .timeInterval(20)
      .words(word_entries)
      .fontSize(function(d) { return xScale(+d.value); })
      .text(function(d) { return d.key; })
      .rotate(function() { return ~~(Math.random() * 2) * 90; })
      .font("Impact")
      .on("end", draw)
      .start();

  function draw(words_entries) {
    var svg = d3.select(svgId)
        .append("svg")
        .attr("width", w)
        .attr("height", h);
    
    var graph = svg.append("g").attr("transform", "translate(" + [w >> 1, h >> 1] + ")")
        
    graph.selectAll("text")
        .data(words_entries)
        .enter()
        .append("text")
        .style("font-size", function(d) { return xScale(d.value) + "px"; })
        .style("font-family", "Impact")
        .style("fill", function(d, i) { return fill(i); })
        .attr("text-anchor", "middle")
        .attr("transform", function(d) {
          return "translate(" + [d.x, d.y] + ")rotate(" + d.rotate + ")";
        })
        .text(function(d) { return d.key; });
  }
}

var most_used_words = {{ most_used_words|safe }};
wordCloud("#most_used_words", most_used_words);
</script>
</html>
